{"version":3,"file":"index.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/symbol.js","../src/slot.js","../src/utils.js","../src/slotMachine.js","../src/index.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React from \"react\"\nimport symbolStyles from \"./symbol.module.scss\"\n\nconst Symbol = ({ symbol, evaluated, defaultStyleClass, evaluatedStyleClass }) =>\n  <div\n    className={ `\n      ${symbolStyles.symbol} \n      ${defaultStyleClass} \n      ${evaluated ? evaluatedStyleClass : \"\"}`\n    }>\n    { symbol }\n  </div>\n\nexport default Symbol\n","import React from \"react\"\nimport anime from \"animejs\"\n\nimport slotStyles from \"./slot.module.scss\"\nimport Symbol from \"./symbol\"\n\nexport default class Slot extends React.Component {\n  constructor(props) {\n    super(props)\n\n    this.$symbols = React.createRef()\n    this.state = { complete: null }\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.reset.bind(this))\n  }\n\n  componentDidUpdate(prevProps) {\n    if (!prevProps.spin && this.props.spin) {\n      this.reset()\n      this.start()\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.reset.bind(this))\n  }\n\n  render() {\n    return (\n      <div ref={ this.$symbols } className={ slotStyles.slot }>\n        { this.props.symbols.map((symbol, index) =>\n          <Symbol\n            key={ index }\n            evaluated={ this.state.complete && index === this.props.symbols.length - 2 }\n            symbol={ symbol }\n            evaluatedStyleClass={ this.props.symbolEvaluatedStyleClass }\n            defaultStyleClass={ this.props.symbolDefaultStyleClass } />\n        ) }\n      </div>\n    )\n  }\n\n  reset() {\n    this.setState({ complete: false })\n    anime({\n      targets: this.$symbols.current,\n      translateY: 0,\n      duration: 0,\n    })\n  }\n\n  start() {\n    anime({\n      targets: this.$symbols.current,\n      translateY: `-${this.$symbols.current.offsetHeight / 3 *\n        (this.props.symbols.length - 3)}px`,\n      duration: 2000,\n      easing: \"easeInOutQuad\",\n      delay: this.props.slotIndex * 500,\n      complete: () => {\n        this.setState(\n          { complete: true },\n          this.props.evaluate(\n            this.props.slotIndex,\n            this.props.symbols[this.props.symbols.length - 2]\n          )\n        )\n      },\n    })\n  }\n}\n","function getRandomElementFromList(list) {\n  return list[Math.floor(Math.random() * list.length)]\n}\n\nfunction fillByWithRandomElement(count, randomElementCollection) {\n  return Array.from(Array(count).keys()).reduce(\n    acc => [...acc, getRandomElementFromList(randomElementCollection)],\n    []\n  )\n}\n\nexport {\n  fillByWithRandomElement,\n  getRandomElementFromList\n}\n","import React from 'react'\nimport Slot from './slot'\nimport * as utils from './utils'\nimport slotMachineStyles from './slotMachine.module.scss'\n\nexport default class SlotMachine extends React.Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      isSpinning: false,\n      isJackpot: false\n    }\n\n    this.slots = [\n      this.createSlot(this.props.initialSymbols[0]),\n      this.createSlot(this.props.initialSymbols[1]),\n      this.createSlot(this.props.initialSymbols[2])\n    ]\n\n    this.prepareSlots(true)\n  }\n\n  componentDidMount() {\n    this.spin()\n  }\n\n  render() {\n    return (\n      <div className={slotMachineStyles.wrapper}>\n        <div className={slotMachineStyles.slotMachine}>\n          { this.slots.map((slot, index) =>\n            <Slot\n              key={index}\n              slotIndex={index}\n              spin={this.state.isSpinning}\n              evaluate={(slotIndex, symbol) => this.saveSingleResult(slotIndex, symbol)}\n              symbolDefaultStyleClass={this.props.symbolDefaultStyleClass}\n              symbolEvaluatedStyleClass={this.props.symbolEvaluatedStyleClass}\n              symbols={slot.symbols} />\n          ) }\n        </div>\n      </div>\n    )\n  }\n\n  spin() {\n    if (!this.state.isSpinning) {\n      this.setState({ isSpinning: true, isJackpot: false })\n    }\n  }\n\n  saveSingleResult(slotIndex, symbol) {\n    this.slots[slotIndex].evaluation = symbol\n\n    return this.slots.filter(slot => slot.evaluation === null).length === 0\n      ? this.broadcastResult()\n      : null\n  }\n\n  broadcastResult() {\n    const isJackpot = this.slots.every(slot => slot.evaluation === this.slots[0].evaluation)\n\n    this.setState({ isSpinning: false, isJackpot })\n    this.props.onSpinningEnd(isJackpot)\n    this.prepareSlots(false)\n  }\n\n  prepareSlots(initital) {\n    this.slots = this.slots.map(slot => ({\n      ...slot,\n      evaluation: null,\n      symbols: !initital\n        ? [\n          ...slot.symbols.slice(slot.symbols.length - 3, slot.symbols.length),\n          ...utils.fillByWithRandomElement(this.props.symbolsPerSlot - 1, this.props.symbols)\n        ]\n        : [\n          ...utils.fillByWithRandomElement(this.props.symbolsPerSlot - 1, this.props.symbols),\n          ...slot.symbols.slice(slot.symbols.length - 3, slot.symbols.length)\n        ]\n    }))\n  }\n\n  createSlot(initialSymbol) {\n    return {\n      symbols: [\n        utils.getRandomElementFromList(this.props.symbols),\n        initialSymbol,\n        utils.getRandomElementFromList(this.props.symbols)\n      ],\n      evaluation: null\n    }\n  }\n}\n\nSlotMachine.defaultProps = {\n  symbols: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],\n  initialSymbols: ['1', '2', '3'],\n  symbolsPerSlot: 20,\n  symbolDefaultStyleClass: 'slotMachine__symbol',\n  symbolEvaluatedStyleClass: 'slotMachine__symbol--evaluated',\n  onSpinningEnd: () => {}\n}\n","import React from \"react\"\nimport SlotMachine from \"./slotMachine\"\n\nexport default React.forwardRef(\n  (props, ref) => <SlotMachine ref={ ref } { ...props } />\n)\n"],"names":["Symbol","symbol","evaluated","defaultStyleClass","evaluatedStyleClass","symbolStyles","Slot","props","$symbols","React","createRef","state","complete","addEventListener","reset","bind","prevProps","spin","start","removeEventListener","slotStyles","slot","symbols","map","index","length","symbolEvaluatedStyleClass","symbolDefaultStyleClass","setState","current","offsetHeight","slotIndex","evaluate","Component","getRandomElementFromList","list","Math","floor","random","fillByWithRandomElement","count","randomElementCollection","Array","from","keys","reduce","acc","SlotMachine","slots","createSlot","initialSymbols","prepareSlots","slotMachineStyles","wrapper","slotMachine","isSpinning","saveSingleResult","isJackpot","evaluation","filter","broadcastResult","every","onSpinningEnd","initital","slice","utils","symbolsPerSlot","initialSymbol","defaultProps","forwardRef","ref"],"mappings":"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"}